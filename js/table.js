const tableCustomer = {
  JSONData: [
    {
      Name: 'Otto Clay',
      Age: 61,
      Country: 6,
      Address: 'Ap #897-1459 Quam Avenue',
      Married: false,
    },
    {
      Name: 'Connor Johnston',
      Age: 73,
      Country: 7,
      Address: 'Ap #370-4647 Dis Av.',
      Married: false,
    },
    {
      Name: 'Lacey Hess',
      Age: 29,
      Country: 7,
      Address: 'Ap #365-8835 Integer St.',
      Married: false,
    },
    {
      Name: 'Timothy Henson',
      Age: 78,
      Country: 1,
      Address: '911-5143 Luctus Ave',
      Married: false,
    },
    {
      Name: 'Ramona Benton',
      Age: 43,
      Country: 5,
      Address: 'Ap #614-689 Vehicula Street',
      Married: true,
    },
    {
      Name: 'Ezra Tillman',
      Age: 51,
      Country: 1,
      Address: 'P.O. Box 738, 7583 Quisque St.',
      Married: true,
    },
    {
      Name: 'Dante Carter',
      Age: 59,
      Country: 1,
      Address: 'P.O. Box 976, 6316 Lorem, St.',
      Married: false,
    },
    {
      Name: 'Christopher Mcclure',
      Age: 58,
      Country: 1,
      Address: '847-4303 Dictum Av.',
      Married: true,
    },
    {
      Name: 'Ruby Rocha',
      Age: 62,
      Country: 2,
      Address: '5212 Sagittis Ave',
      Married: false,
    },
    {
      Name: 'Imelda Hardin',
      Age: 39,
      Country: 5,
      Address: '719-7009 Auctor Av.',
      Married: false,
    },
    {
      Name: 'Jonah Johns',
      Age: 28,
      Country: 5,
      Address: 'P.O. Box 939, 9310 A Ave',
      Married: false,
    },
    {
      Name: 'Herman Rosa',
      Age: 49,
      Country: 7,
      Address: '718-7162 Molestie Av.',
      Married: true,
    },
    {
      Name: 'Arthur Gay',
      Age: 20,
      Country: 7,
      Address: '5497 Neque Street',
      Married: false,
    },
    {
      Name: 'Xena Wilkerson',
      Age: 63,
      Country: 1,
      Address: 'Ap #303-6974 Proin Street',
      Married: true,
    },
    {
      Name: 'Lilah Atkins',
      Age: 33,
      Country: 5,
      Address: '622-8602 Gravida Ave',
      Married: true,
    },
    {
      Name: 'Malik Shepard',
      Age: 59,
      Country: 1,
      Address: '967-5176 Tincidunt Av.',
      Married: false,
    },
    {
      Name: 'Keely Silva',
      Age: 24,
      Country: 1,
      Address: 'P.O. Box 153, 8995 Praesent Ave',
      Married: false,
    },
    {
      Name: 'Hunter Pate',
      Age: 73,
      Country: 7,
      Address: 'P.O. Box 771, 7599 Ante, Road',
      Married: false,
    },
    {
      Name: 'Mikayla Roach',
      Age: 55,
      Country: 5,
      Address: 'Ap #438-9886 Donec Rd.',
      Married: true,
    },
    {
      Name: 'Upton Joseph',
      Age: 48,
      Country: 4,
      Address: 'Ap #896-7592 Habitant St.',
      Married: true,
    },
    {
      Name: 'Jeanette Pate',
      Age: 59,
      Country: 2,
      Address: 'P.O. Box 177, 7584 Amet, St.',
      Married: false,
    },
    {
      Name: 'Kaden Hernandez',
      Age: 79,
      Country: 3,
      Address: '366 Ut St.',
      Married: true,
    },
    {
      Name: 'Kenyon Stevens',
      Age: 20,
      Country: 3,
      Address: 'P.O. Box 704, 4580 Gravida Rd.',
      Married: false,
    },
    {
      Name: 'Jerome Harper',
      Age: 31,
      Country: 5,
      Address: '2464 Porttitor Road',
      Married: false,
    },
    {
      Name: 'Jelani Patel',
      Age: 36,
      Country: 2,
      Address: 'P.O. Box 541, 5805 Nec Av.',
      Married: true,
    },
    {
      Name: 'Keaton Oconnor',
      Age: 21,
      Country: 1,
      Address: 'Ap #657-1093 Nec, Street',
      Married: false,
    },
    {
      Name: 'Bree Johnston',
      Age: 31,
      Country: 2,
      Address: '372-5942 Vulputate Avenue',
      Married: false,
    },
    {
      Name: 'Maisie Hodges',
      Age: 70,
      Country: 7,
      Address: 'P.O. Box 445, 3880 Odio, Rd.',
      Married: false,
    },
    {
      Name: 'Kuame Calhoun',
      Age: 39,
      Country: 2,
      Address: 'P.O. Box 609, 4105 Rutrum St.',
      Married: true,
    },
    {
      Name: 'Carlos Cameron',
      Age: 38,
      Country: 5,
      Address: 'Ap #215-5386 A, Avenue',
      Married: false,
    },
    {
      Name: 'Fulton Parsons',
      Age: 25,
      Country: 7,
      Address: 'P.O. Box 523, 3705 Sed Rd.',
      Married: false,
    },
    {
      Name: 'Wallace Christian',
      Age: 43,
      Country: 3,
      Address: '416-8816 Mauris Avenue',
      Married: true,
    },
    {
      Name: 'Caryn Maldonado',
      Age: 40,
      Country: 1,
      Address: '108-282 Nonummy Ave',
      Married: false,
    },
    {
      Name: 'Whilemina Frank',
      Age: 20,
      Country: 7,
      Address: 'P.O. Box 681, 3938 Egestas. Av.',
      Married: true,
    },
    {
      Name: 'Emery Moon',
      Age: 41,
      Country: 4,
      Address: 'Ap #717-8556 Non Road',
      Married: true,
    },
    {
      Name: 'Price Watkins',
      Age: 35,
      Country: 4,
      Address: '832-7810 Nunc Rd.',
      Married: false,
    },
    {
      Name: 'Lydia Castillo',
      Age: 59,
      Country: 7,
      Address: '5280 Placerat, Ave',
      Married: true,
    },
    {
      Name: 'Lawrence Conway',
      Age: 53,
      Country: 1,
      Address: 'Ap #452-2808 Imperdiet St.',
      Married: false,
    },
    {
      Name: 'Kalia Nicholson',
      Age: 67,
      Country: 5,
      Address: 'P.O. Box 871, 3023 Tellus Road',
      Married: true,
    },
    {
      Name: 'Brielle Baxter',
      Age: 45,
      Country: 3,
      Address: 'Ap #822-9526 Ut, Road',
      Married: true,
    },
    {
      Name: 'Valentine Brady',
      Age: 72,
      Country: 7,
      Address: '8014 Enim. Road',
      Married: true,
    },
    {
      Name: 'Rebecca Gardner',
      Age: 57,
      Country: 4,
      Address: '8655 Arcu. Road',
      Married: true,
    },
    {
      Name: 'Vladimir Tate',
      Age: 26,
      Country: 1,
      Address: '130-1291 Non, Rd.',
      Married: true,
    },
    {
      Name: 'Vernon Hays',
      Age: 56,
      Country: 4,
      Address: '964-5552 In Rd.',
      Married: true,
    },
    {
      Name: 'Allegra Hull',
      Age: 22,
      Country: 4,
      Address: '245-8891 Donec St.',
      Married: true,
    },
    {
      Name: 'Hu Hendrix',
      Age: 65,
      Country: 7,
      Address: '428-5404 Tempus Ave',
      Married: true,
    },
    {
      Name: 'Kenyon Battle',
      Age: 32,
      Country: 2,
      Address: '921-6804 Lectus St.',
      Married: false,
    },
    {
      Name: 'Gloria Nielsen',
      Age: 24,
      Country: 4,
      Address: 'Ap #275-4345 Lorem, Street',
      Married: true,
    },
    {
      Name: 'Illiana Kidd',
      Age: 59,
      Country: 2,
      Address: '7618 Lacus. Av.',
      Married: false,
    },
    {
      Name: 'Adria Todd',
      Age: 68,
      Country: 6,
      Address: '1889 Tincidunt Road',
      Married: false,
    },
    {
      Name: 'Kirsten Mayo',
      Age: 71,
      Country: 1,
      Address: '100-8640 Orci, Avenue',
      Married: false,
    },
    {
      Name: 'Willa Hobbs',
      Age: 60,
      Country: 6,
      Address: 'P.O. Box 323, 158 Tristique St.',
      Married: false,
    },
    {
      Name: 'Alexis Clements',
      Age: 69,
      Country: 5,
      Address: 'P.O. Box 176, 5107 Proin Rd.',
      Married: false,
    },
    {
      Name: 'Akeem Conrad',
      Age: 60,
      Country: 2,
      Address: '282-495 Sed Ave',
      Married: true,
    },
    {
      Name: 'Montana Silva',
      Age: 79,
      Country: 6,
      Address: 'P.O. Box 120, 9766 Consectetuer St.',
      Married: false,
    },
    {
      Name: 'Kaseem Hensley',
      Age: 77,
      Country: 6,
      Address: 'Ap #510-8903 Mauris. Av.',
      Married: true,
    },
    {
      Name: 'Christopher Morton',
      Age: 35,
      Country: 5,
      Address: 'P.O. Box 234, 3651 Sodales Avenue',
      Married: false,
    },
    {
      Name: 'Wade Fernandez',
      Age: 49,
      Country: 6,
      Address: '740-5059 Dolor. Road',
      Married: true,
    },
    {
      Name: 'Illiana Kirby',
      Age: 31,
      Country: 2,
      Address: '527-3553 Mi Ave',
      Married: false,
    },
    {
      Name: 'Kimberley Hurley',
      Age: 65,
      Country: 5,
      Address: 'P.O. Box 637, 9915 Dictum St.',
      Married: false,
    },
    {
      Name: 'Arthur Olsen',
      Age: 74,
      Country: 5,
      Address: '887-5080 Eget St.',
      Married: false,
    },
    {
      Name: 'Brody Potts',
      Age: 59,
      Country: 2,
      Address: 'Ap #577-7690 Sem Road',
      Married: false,
    },
    {
      Name: 'Dillon Ford',
      Age: 60,
      Country: 1,
      Address: 'Ap #885-9289 A, Av.',
      Married: true,
    },
    {
      Name: 'Hannah Juarez',
      Age: 61,
      Country: 2,
      Address: '4744 Sapien, Rd.',
      Married: true,
    },
    {
      Name: 'Vincent Shaffer',
      Age: 25,
      Country: 2,
      Address: '9203 Nunc St.',
      Married: true,
    },
    {
      Name: 'George Holt',
      Age: 27,
      Country: 6,
      Address: '4162 Cras Rd.',
      Married: false,
    },
    {
      Name: 'Tobias Bartlett',
      Age: 74,
      Country: 4,
      Address: '792-6145 Mauris St.',
      Married: true,
    },
    {
      Name: 'Xavier Hooper',
      Age: 35,
      Country: 1,
      Address: '879-5026 Interdum. Rd.',
      Married: false,
    },
    {
      Name: 'Declan Dorsey',
      Age: 31,
      Country: 2,
      Address: 'Ap #926-4171 Aenean Road',
      Married: true,
    },
    {
      Name: 'Clementine Tran',
      Age: 43,
      Country: 4,
      Address: 'P.O. Box 176, 9865 Eu Rd.',
      Married: true,
    },
    {
      Name: 'Pamela Moody',
      Age: 55,
      Country: 6,
      Address: '622-6233 Luctus Rd.',
      Married: true,
    },
    {
      Name: 'Julie Leon',
      Age: 43,
      Country: 6,
      Address: 'Ap #915-6782 Sem Av.',
      Married: true,
    },
    {
      Name: 'Shana Nolan',
      Age: 79,
      Country: 5,
      Address: 'P.O. Box 603, 899 Eu St.',
      Married: false,
    },
    {
      Name: 'Vaughan Moody',
      Age: 37,
      Country: 5,
      Address: '880 Erat Rd.',
      Married: false,
    },
    {
      Name: 'Randall Reeves',
      Age: 44,
      Country: 3,
      Address: '1819 Non Street',
      Married: false,
    },
    {
      Name: 'Dominic Raymond',
      Age: 68,
      Country: 1,
      Address: 'Ap #689-4874 Nisi Rd.',
      Married: true,
    },
    {
      Name: 'Lev Pugh',
      Age: 69,
      Country: 5,
      Address: 'Ap #433-6844 Auctor Avenue',
      Married: true,
    },
    {
      Name: 'Desiree Hughes',
      Age: 80,
      Country: 4,
      Address: '605-6645 Fermentum Avenue',
      Married: true,
    },
    {
      Name: 'Idona Oneill',
      Age: 23,
      Country: 7,
      Address: '751-8148 Aliquam Avenue',
      Married: true,
    },
    {
      Name: 'Lani Mayo',
      Age: 76,
      Country: 1,
      Address: '635-2704 Tristique St.',
      Married: true,
    },
    {
      Name: 'Cathleen Bonner',
      Age: 40,
      Country: 1,
      Address: '916-2910 Dolor Av.',
      Married: false,
    },
    {
      Name: 'Sydney Murray',
      Age: 44,
      Country: 5,
      Address: '835-2330 Fringilla St.',
      Married: false,
    },
    {
      Name: 'Brenna Rodriguez',
      Age: 77,
      Country: 6,
      Address: '3687 Imperdiet Av.',
      Married: true,
    },
    {
      Name: 'Alfreda Mcdaniel',
      Age: 38,
      Country: 7,
      Address: '745-8221 Aliquet Rd.',
      Married: true,
    },
    {
      Name: 'Zachery Atkins',
      Age: 30,
      Country: 1,
      Address: '549-2208 Auctor. Road',
      Married: true,
    },
    {
      Name: 'Amelia Rich',
      Age: 56,
      Country: 4,
      Address: 'P.O. Box 734, 4717 Nunc Rd.',
      Married: false,
    },
    {
      Name: 'Kiayada Witt',
      Age: 62,
      Country: 3,
      Address: 'Ap #735-3421 Malesuada Avenue',
      Married: false,
    },
    {
      Name: 'Lysandra Pierce',
      Age: 36,
      Country: 1,
      Address: 'Ap #146-2835 Curabitur St.',
      Married: true,
    },
    {
      Name: 'Cara Rios',
      Age: 58,
      Country: 4,
      Address: 'Ap #562-7811 Quam. Ave',
      Married: true,
    },
    {
      Name: 'Austin Andrews',
      Age: 55,
      Country: 7,
      Address: 'P.O. Box 274, 5505 Sociis Rd.',
      Married: false,
    },
    {
      Name: 'Lillian Peterson',
      Age: 39,
      Country: 2,
      Address: '6212 A Avenue',
      Married: false,
    },
    {
      Name: 'Adria Beach',
      Age: 29,
      Country: 2,
      Address: 'P.O. Box 183, 2717 Nunc Avenue',
      Married: true,
    },
    {
      Name: 'Oleg Durham',
      Age: 80,
      Country: 4,
      Address: '931-3208 Nunc Rd.',
      Married: false,
    },
    {
      Name: 'Casey Reese',
      Age: 60,
      Country: 4,
      Address: '383-3675 Ultrices, St.',
      Married: false,
    },
    {
      Name: 'Kane Burnett',
      Age: 80,
      Country: 1,
      Address: '759-8212 Dolor. Ave',
      Married: false,
    },
    {
      Name: 'Stewart Wilson',
      Age: 46,
      Country: 7,
      Address: '718-7845 Sagittis. Av.',
      Married: false,
    },
    {
      Name: 'Charity Holcomb',
      Age: 31,
      Country: 6,
      Address: '641-7892 Enim. Ave',
      Married: false,
    },
    {
      Name: 'Kyra Cummings',
      Age: 43,
      Country: 4,
      Address: 'P.O. Box 702, 6621 Mus. Av.',
      Married: false,
    },
    {
      Name: 'Stuart Wallace',
      Age: 25,
      Country: 7,
      Address: '648-4990 Sed Rd.',
      Married: true,
    },
    {
      Name: 'Carter Clarke',
      Age: 59,
      Country: 6,
      Address: 'Ap #547-2921 A Street',
      Married: false,
    },
  ],
  countryData: [
    { Name: '', Id: 0 },
    { Name: 'United States', Id: 1 },
    { Name: 'Canada', Id: 2 },
    { Name: 'United Kingdom', Id: 3 },
    { Name: 'France', Id: 4 },
    { Name: 'Brazil', Id: 5 },
    { Name: 'China', Id: 6 },
    { Name: 'Russia', Id: 7 },
  ],
  sortBy: {
    Name: false,
    Age: false,
    Address: false,
    Country: false,
    Married: false,
    choose: '',
  },
  itemPerPage: [5, 8, 10, 13, 15, 20, 'all'],
  filterBy: {
    name: '',
    age: '',
    country: '',
    address: '',
    married: 2,
  },
  currentPage: 1,
  dataShow: [],
  choosingItem: {},
  bgChoosingItem: '',
  editActive: 0,
  filterActive: 0,
  size: 8,
  totalRecord: 0,
  totalPage: 0,
  queryRoot: '',
  renderAppForm() {
    let table = document.createElement('table');
    let ul = document.createElement('ul');

    table.className = 'customer-table';
    table.id = 'customer-table';
    table.innerHTML =
      '<thead class="text-center"></thead><tbody class="list-items"></tbody>';
    this.queryRoot.appendChild(table);

    ul.className = 'pagination';
    this.queryRoot.appendChild(ul);
  },
  renderTableForm() {
    let table = document.createElement('table');
    table.className = 'customer-table';
    table.id = 'customer-table';
    let tableHtml =
      '<thead class="text-center"></thead><tbody class="customers-list"></tbody>';
    table.innerHTML = tableHtml;
    this.queryRoot.appendChild(table);
  },
  renderSortForm() {
    let div = document.createElement('div');
    let dropdownSort = '';
    for (let i in this.JSONData[0]) {
      dropdownSort += `<option value=${i}>${i}</option>`;
    }
    div.className = 'sort-panel';
    div.innerHTML = `<label>Sorting Field:
                          <select id="sortingField">  ${dropdownSort}</select>
                          <button type="button" id="sort">Sort</button>
                      </label>`;
    this.queryRoot.appendChild(div);
  },
  sortByField() {
    let btnSort = this.queryRoot.querySelector('#sort');
    let dropDownSort = this.queryRoot.querySelector('#sortingField');
    let fieldChooseSort;
    btnSort.addEventListener('click', () => {
      if (this.sortBy.choose != '') {
        this.queryRoot.querySelector(`.${this.sortBy.choose}`).innerHTML =
          this.sortBy.choose;
      }
      this.sortBy.choose = dropDownSort.value;
      this.sortBy[dropDownSort.value] = !this.sortBy[dropDownSort.value];
      fieldChooseSort = this.queryRoot.querySelector(`.${this.sortBy.choose}`);

      if (this.sortBy.choose == 'Country') {
        this.dataShow = this.dataShow.sort((a, b) =>
          this.getCountryName(a[this.sortBy.choose]) >
          this.getCountryName(b[this.sortBy.choose])
            ? 1
            : -1
        );
      } else {
        this.dataShow = this.dataShow.sort((a, b) =>
          a[this.sortBy.choose] > b[this.sortBy.choose] ? 1 : -1
        );
      }
      if (this.sortBy[this.sortBy.choose]) {
        fieldChooseSort.innerHTML = `${this.sortBy.choose}<i class="fa sort fa-sort-asc" aria-hidden="true"></i>`;
      } else {
        this.dataShow.reverse();
        fieldChooseSort.innerHTML = `${this.sortBy.choose}<i class="fa sort fa-sort-desc" aria-hidden="true"></i>`;
      }
      this.loadData();
    });
  },
  renderPagination() {
    this.queryRoot.querySelector('.pagination').innerHTML = `<li>Pages: </li>
        <li class="btn-first btn-hover" href="#">First</li>
        <li class="btn-prev btn-hover" href="#">Prev</li>
        <li class="page-number-items"><ul class="page-number-items"></ul></li>
        <li class="btn-next btn-hover" href="#">Next</li>
        <li class="btn-last btn-hover" href="#">Last</li>
        <li class="page-per-total"></li>`;
    this.totalPage = Math.ceil(this.totalRecord / this.size);
    this.renderNumberPage();
  },
  renderNumberPage() {
    let pageNumberHtml = '';
    let pageArr = this.handlePagination();
    for (let i in pageArr) {
      if (pageArr[i] == this.currentPage) {
        pageNumberHtml += `<li class='number-page active'>${pageArr[i]}</li>`;
      } else if (pageArr[i] != '...') {
        pageNumberHtml += `<li class='number-page'>${pageArr[i]}</li>`;
      } else {
        pageNumberHtml += `<li class='three-dots'>${pageArr[i]}</li>`;
      }
    }
    this.queryRoot.querySelector('.page-number-items').innerHTML =
      pageNumberHtml;
    this.queryRoot.querySelector(
      '.page-per-total'
    ).innerHTML = `${this.currentPage} of ${this.totalPage}`;
  },
  renderSearchRow() {
    let searchRow = document.createElement('tr');
    searchRow.className = 'search-row hidden';
    searchRow.innerHTML = `<tr>
                        <th><input type="text" class="field-name" /></th>
                        <th><input type="number" class="field-age" /></th>
                        <th>
                          <select name="field-country" class="field-country" id="field-country">
                          ${this.countryData
                            .map(
                              (item) =>
                                `<option value=${item.Id}>${item.Name}</option>`
                            )
                            .join('')}</select>
                        </th>
                        <th><input type="text" class="field-address" /></th>
                        <th><input type="checkbox" class="field-married"/></th>
                        <th>
                          <i class="fa btn btn-filter fa-search" aria-hidden="true"></i>
                          <i class="fa btn btn-clear-filter fa-filter" aria-hidden="true"></i>
                        </th>
                      </tr>`;
    this.queryRoot
      .querySelector('.customer-table thead')
      .appendChild(searchRow);
  },
  renderHeadRow() {
    let headRow = document.createElement('tr');
    let headerHTML = '';
    let headRowNames = Object.keys(this.JSONData[0]);
    headRowNames.map((item) => {
      headerHTML += `<th class=${item}>${item}</th>`;
    });
    headerHTML += `<th>
                      <a class="btn-search"><i class="fa fa-search" aria-hidden="true"></i></a>
                    </th>`;
    headRow.innerHTML = headerHTML;
    this.queryRoot.querySelector('.customer-table thead').appendChild(headRow);
  },
  renderEditRow(index) {
    return `<tr class='edit-row'>
              <td><input type="text" value='${
                this.choosingItem.children[0].textContent
              }' class="edit-name" /></td>
              <td><input type="number" value=${
                this.choosingItem.children[1].textContent
              } class="edit-age" /></td>
              <td>
                <select
                  name="edit-country"
                  class="edit-country"
                  id="edit-country"
                >${this.countryData
                  .map(
                    (country) =>
                      `<option value=${country.Id} ${
                        country.Id == this.choosingItem.children[2].dataset.id
                          ? 'selected'
                          : ''
                      }>${country.Name}</option>`
                  )
                  .join('')}</select>
              </td>
              <td><input type="text" value='${
                this.choosingItem.children[3].textContent
              }' class="edit-address" /></td>
              <td class="text-center"><input type="checkbox" class="edit-married" ${
                this.choosingItem.children[4].dataset.checked == 'true'
                  ? 'checked'
                  : ''
              }/></td>
              <td class="text-center">
                <i class="fa btn btn-save fa-check" aria-hidden="true" data-index=${index}></i>
                <i class="fa btn btn-unsave fa-times" aria-hidden="true" data-index=${index}></i>
              </td>
            </tr>`;
  },
  renderPageSize() {
    let div = document.createElement('div');
    let dropdownSort = this.itemPerPage
      .map(
        (item) =>
          `<option value=${item} ${
            item == this.size ? 'selected' : ''
          }>${item}</option>`
      )
      .join('');
    div.className = 'page-size';
    div.innerHTML = `<label>Page size:
                          <select id="page-size">${dropdownSort}</select>
                      </label>`;
    this.queryRoot.querySelector('.pagination').appendChild(div);
  },
  loadData() {
    let dataTable = '';
    this.totalRecord = this.dataShow.length;
    if (this.totalRecord > 0) {
      let pagePerTotal = this.queryRoot.querySelector('.page-per-total');
      let start, end;
      pagePerTotal.innerHTML = `${this.currentPage} of ${this.totalPage}`;
      this.totalPage = Math.ceil(this.totalRecord / this.size);

      start = (this.currentPage - 1) * this.size;
      end = this.currentPage * this.size;
      if (end > this.totalRecord) {
        end = this.totalRecord;
      }
      for (let i = start; i < end; i += 1) {
        dataTable += `<tr>
          <td>${this.dataShow[i].Name}</td>
          <td class="text-center">${this.dataShow[i].Age}</td>
          <td data-id=${this.dataShow[i].Country}>
            ${this.getCountryName(this.dataShow[i].Country)}
          </td>
          </td><td>${this.dataShow[i].Address}</td>
          <td class="text-center" data-checked=${this.dataShow[i].Married}>
              <input type="checkbox" name="married" id="married" ${
                this.dataShow[i].Married ? 'checked' : ''
              } disabled/>
          <td class="text-center">
              <i class="edit btn btn-edit fa fa-pencil-square-o" aria-hidden="true" data-index=${i}></i>
              <i class="delete btn btn-delete fa fa-trash" data-index=${i}></i>
          </td>
      </tr>`;
      }
    } else {
      dataTable = '<div>No result can be found</div>';
    }

    let customerList = document.createElement('tbody');
    customerList.innerHTML = dataTable;
    this.queryRoot.querySelector('.customer-table tbody').innerHTML = dataTable;
  },
  getCountryName(id) {
    return this.countryData.find((country) => country.Id == id).Name;
  },
  showOrHideButtonPagination() {
    if (this.currentPage === 1) {
      this.queryRoot.querySelector('.btn-prev').className =
        'btn btn-prev hidden';
      this.queryRoot.querySelector('.btn-first').className =
        'btn btn-first hidden';
    } else {
      this.queryRoot.querySelector('.btn-prev').className = 'btn btn-prev';
      this.queryRoot.querySelector('.btn-first').className = 'btn btn-first';
    }
    if (this.currentPage == this.totalPage) {
      this.queryRoot.querySelector('.btn-next').className =
        'btn btn-next hidden';
      this.queryRoot.querySelector('.btn-last').className =
        'btn btn-last hidden';
    } else {
      this.queryRoot.querySelector('.btn-next').className = 'btn btn-next';
      this.queryRoot.querySelector('.btn-last').className = 'btn btn-last';
    }
  },
  numberPageChange() {
    this.showOrHideButtonPagination();
    let curPage = this.queryRoot.querySelectorAll(
      'ul.pagination li.number-page'
    );
    let curPageSize = curPage.length;
    for (let i = 0; i < curPageSize; i += 1) {
      curPage[i].addEventListener('click', () => {
        $('ul.pagination li.number-page').removeClass('active');
        this.currentPage = +curPage[i].textContent;

        curPage[i].className = 'active number-page';
        this.renderNumberPage();
        this.loadData();
        this.numberPageChange();
      });
    }
  },
  currentPageChange() {
    let curPage = this.queryRoot.querySelectorAll(
      'ul.pagination li.number-page'
    );
    let btnNext = this.queryRoot.querySelector('.btn-next');
    let btnPrevious = this.queryRoot.querySelector('.btn-prev');
    let btnLast = this.queryRoot.querySelector('.btn-last');
    let btnFirst = this.queryRoot.querySelector('.btn-first');

    btnNext.addEventListener('click', () => {
      this.showOrHideButtonPagination();
      this.currentPage += 1;
      if (this.currentPage >= this.totalPage) {
        this.currentPage = this.totalPage;
      }
      curPage = this.queryRoot.querySelectorAll('ul.pagination li.number-page');
      $('ul.pagination li.number-page').removeClass('active');
      for (let i in curPage) {
        if (curPage[i].textContent == this.currentPage) {
          curPage[i].className = 'active number-page';
          reRender();
          break;
        }
      }
    });

    btnPrevious.addEventListener('click', () => {
      this.showOrHideButtonPagination();
      this.currentPage -= 1;
      if (this.currentPage <= 1) {
        this.currentPage = 1;
      }

      curPage = this.queryRoot.querySelectorAll('ul.pagination li.number-page');
      $('ul.pagination li.number-page').removeClass('active');
      for (let i in curPage) {
        if (curPage[i].textContent == this.currentPage) {
          curPage[i].className = 'active number-page';
          break;
        }
      }
      reRender();
    });

    btnLast.addEventListener('click', () => {
      this.showOrHideButtonPagination();
      this.currentPage = this.totalPage;
      curPage = this.queryRoot.querySelectorAll('ul.pagination li.number-page');
      $('ul.pagination li.number-page').removeClass('active');
      curPage[curPage.length - 1].className = 'active number-page';
      reRender();
    });

    btnFirst.addEventListener('click', () => {
      this.showOrHideButtonPagination();
      this.currentPage = 1;
      curPage = this.queryRoot.querySelector('ul.pagination li.number-page');
      $('ul.pagination li.number-page').removeClass('active');
      curPage.className = 'active number-page';
      reRender();
    });

    const reRender = () => {
      tableCustomer.renderNumberPage();
      tableCustomer.numberPageChange();
      tableCustomer.loadData();
    };
  },
  showAlert(message, className) {
    const div = document.createElement('div');
    div.className = `alert alert-${className}`;
    div.appendChild(document.createTextNode(message));
    const app = document.querySelector('#app');
    const main = document.querySelector('.main');
    app.insertBefore(div, main);
    setTimeout(() => document.querySelector('.alert').remove(), 1000);
  },
  saveEditItem(index) {
    let cusInfo = {};
    cusInfo.Name = this.choosingItem.children[0].children[0].value;
    cusInfo.Age = Number(this.choosingItem.children[1].children[0].value);
    cusInfo.Country = Number(this.choosingItem.children[2].children[0].value);
    cusInfo.Address = this.choosingItem.children[3].children[0].value;
    cusInfo.Married = this.choosingItem.children[4].children[0].checked;
    if (this.validateInfomation(cusInfo)) {
      this.JSONData[
        this.JSONData.findIndex((item) => item == this.dataShow[index])
      ] = cusInfo;
      this.dataShow[index] = cusInfo;
      this.editActive = 0;
      this.loadData();
      this.showAlert('Sửa thành công', 'success');
    }
  },
  cancelEditItem() {
    this.choosingItem.innerHTML = this.bgChoosingItem;
    this.editActive = 0;
  },
  handleDeleteItem(index) {
    let newTotalPage;
    this.JSONData.splice(
      this.JSONData.findIndex((x) => x == this.dataShow[index]),
      1
    );
    this.dataShow.splice(index, 1);
    this.showAlert('Xóa thành công', 'success');
    this.totalRecord = this.dataShow.length;
    newTotalPage = Math.ceil(this.totalRecord / this.size);
    if (newTotalPage < this.totalPage) {
      if (this.currentPage > newTotalPage) {
        this.currentPage -= 1;
      }
      if (this.currentPage == 0) {
        this.queryRoot.querySelector('.pagination').className =
          'pagination hidden';
      }
      this.totalPage = newTotalPage;
      this.renderNumberPage();
      this.numberPageChange();
    }
  },
  validateInfomation(item) {
    if (item.Name == '') {
      this.showAlert('Tên không được để trống!', 'error');
      return false;
    }
    if (item.Age < 18 || item.Age > 80) {
      this.showAlert('Tuổi từ 18 -> 80', 'error');
      return false;
    }
    if (item.Country == 0) {
      this.showAlert('Quốc gia không được để trống!', 'error');
      return false;
    }
    if (item.Address == '') {
      this.showAlert('Địa chỉ không được để trống!', 'error');
      return false;
    }
    return true;
  },
  handlePagination() {
    let current = this.currentPage,
      last = this.totalPage,
      delta = 2,
      left = current - delta,
      right = current + delta + 1,
      range = [],
      rangeWithDots = [],
      l;

    for (let i = 1; i <= last; i++) {
      if (i == 1 || i == last || (i >= left && i < right)) {
        range.push(i);
      }
    }

    for (let i of range) {
      if (l) {
        if (i - l === 2) {
          rangeWithDots.push(l + 1);
        } else if (i - l !== 1) {
          rangeWithDots.push('...');
        }
      }
      rangeWithDots.push(i);
      l = i;
    }
    return rangeWithDots;
  },
  itemPerPageChange() {
    let itemPerPage = this.queryRoot.querySelector('#page-size');
    itemPerPage.addEventListener('change', () => {
      if (itemPerPage.value != 'all') {
        this.size = itemPerPage.value;
      } else {
        this.size = this.totalRecord;
      }
      this.currentPage = 1;
      this.loadData();
      this.renderNumberPage();
      this.numberPageChange();
    });
  },
  handleSearchClick() {
    if (this.filterActive == 0) {
      this.queryRoot.querySelector('.search-row').className = 'search-row';
      this.filterActive = 1;
    } else {
      this.queryRoot.querySelector('.search-row').className =
        'search-row hidden';
      this.handleClearFilter();
      this.filterActive = 0;
    }
  },
  handleBtnClearFilterClick() {
    if (this.sortBy.choose != '') {
      this.queryRoot.querySelector(`.${this.sortBy.choose}`).innerHTML =
        this.sortBy.choose;
    }
    this.queryRoot.querySelector('.pagination').className = 'pagination';
    this.handleClearFilter();
  },
  handleClearFilter() {
    this.filterBy['married'] = 'default';
    this.queryRoot.querySelector('.field-name').value = '';
    this.queryRoot.querySelector('.field-age').value = '';
    this.queryRoot.querySelector('.field-country').value = 0;
    this.queryRoot.querySelector('.field-address').value = '';
    this.queryRoot.querySelector('.field-married').checked = false;
    this.queryRoot.querySelector('.field-married').indeterminate = true;
    this.filterBy['married'] = 2;
    this.dataShow = [...this.JSONData];
    this.totalRecord = this.dataShow.length;
    this.currentPage = 1;
    this.loadData();
    this.renderNumberPage();
    this.numberPageChange();
  },
  getFilterInputValue() {
    this.filterBy['name'] = this.queryRoot
      .querySelector('.field-name')
      .value.trim();
    this.filterBy['age'] = this.queryRoot.querySelector('.field-age').value;
    this.filterBy['country'] =
      this.queryRoot.querySelector('.field-country').value;
    this.filterBy['address'] = this.queryRoot
      .querySelector('.field-address')
      .value.trim();
  },
  filterDataByField() {
    if (this.filterBy['name'] != '') {
      this.dataShow = this.dataShow.filter((item) =>
        item.Name.toLowerCase().includes(this.filterBy['name'].toLowerCase())
      );
    }
    if (this.filterBy['age'] > 0) {
      this.dataShow = this.dataShow.filter(
        (item) => item.Age == this.filterBy['age']
      );
    }
    if (this.filterBy['country'] > 0) {
      this.dataShow = this.dataShow.filter(
        (item) => item.Country == this.filterBy['country']
      );
    }
    if (this.filterBy['address'] != '') {
      this.dataShow = this.dataShow.filter((item) =>
        item.Address.toLowerCase().includes(
          this.filterBy['address'].toLowerCase()
        )
      );
    }
    if (this.filterBy['married'] != '2') {
      this.dataShow = this.dataShow.filter(
        (item) => item.Married == this.filterBy['married']
      );
    }
  },
  handleFilterClick() {
    if (this.sortBy.choose != '') {
      this.queryRoot.querySelector(`.${this.sortBy.choose}`).innerHTML =
        this.sortBy.choose;
    }
    this.dataShow = [...this.JSONData];
    this.getFilterInputValue();
    this.filterDataByField();
    this.totalRecord = this.dataShow.length;

    if (this.totalRecord == 0) {
      this.showAlert('No result can be found', 'info');
      this.queryRoot.querySelector('.pagination').className =
        'pagination hidden';
      this.loadData();
    } else {
      this.queryRoot.querySelector('.pagination').className = 'pagination';
      this.showAlert(`${this.totalRecord} results be found`, 'info');
      this.currentPage = 1;
      this.loadData();
      this.renderNumberPage();
      this.numberPageChange();
    }
  },
  addEvents() {
    const listItems = this.queryRoot.querySelector('.list-items');
    const btnFilter = this.queryRoot.querySelector('.btn-filter');
    const btnSearch = this.queryRoot.querySelector('.btn-search');
    const btnClearFilter = this.queryRoot.querySelector('.btn-clear-filter');
    const fieldMarried = this.queryRoot.querySelector('.field-married');
    let currentRow, index, targ;
    fieldMarried.indeterminate = true;

    listItems.addEventListener('click', (e) => {
      targ = e.target;
      currentRow = targ.parentElement.parentElement;
      if (targ.classList.contains('edit')) {
        index = targ.dataset.index;
        if (this.editActive == 1) {
          this.choosingItem.innerHTML = this.bgChoosingItem;
        }
        this.editActive = 1;
        this.choosingItem = currentRow;
        this.bgChoosingItem = currentRow.innerHTML;
        currentRow.innerHTML = this.renderEditRow(index);
        this.queryRoot
          .querySelector('.btn-save')
          .addEventListener('click', () => {
            this.saveEditItem(index);
          });

        this.queryRoot
          .querySelector('.btn-unsave')
          .addEventListener('click', () => {
            this.cancelEditItem();
          });
      }

      if (targ.classList.contains('delete')) {
        if (confirm('Confirm DELETE this customer?')) {
          currentRow.remove();
          this.handleDeleteItem(targ.dataset.index);
        }
        this.loadData();
      }
    });
    btnFilter.addEventListener('click', () => this.handleFilterClick());
    btnClearFilter.addEventListener('click', () =>
      this.handleBtnClearFilterClick()
    );
    btnSearch.addEventListener('click', () => this.handleSearchClick());
    fieldMarried.addEventListener('click', () => {
      switch (this.filterBy['married']) {
        case 0:
          this.filterBy['married'] = 2;
          fieldMarried.indeterminate = true;
          fieldMarried.checked = !fieldMarried.checked;
          break;
        case 1:
          this.filterBy['married'] = 0;
          break;
        default:
          this.filterBy['married'] = 1;
      }
    });

    this.itemPerPageChange();
    this.currentPageChange();
    this.numberPageChange();
    this.sortByField();
  },
  render() {
    this.renderSortForm();
    this.renderAppForm();
    this.renderPagination();
    this.renderHeadRow();
    this.renderSearchRow();
    this.renderPageSize();
  },
  init(container) {
    this.queryRoot = document.querySelector(container);
    this.dataShow = [...this.JSONData];
    this.totalRecord = this.dataShow.length;
    this.render();
    this.loadData();
    this.addEvents();
  },
};

function init() {
  tableCustomer.init('#app');
}

init();
